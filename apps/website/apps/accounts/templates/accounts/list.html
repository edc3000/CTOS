{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="accounts-container">
  <div class="accounts-header">
    <h2>è´¦æˆ·ä¿¡æ¯ç®¡ç†</h2>
    <div class="controls">
      <div class="account-selector">
        <label for="exchange-select">é€‰æ‹©äº¤æ˜“æ‰€:</label>
        <select id="exchange-select">
          <option value="">å…¨éƒ¨äº¤æ˜“æ‰€</option>
          {% for exchange in exchanges %}
          <option value="{{ exchange }}">{{ exchange|upper }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="refresh-controls">
        <button id="refresh-btn" class="btn btn-primary">
          <span class="refresh-icon">ğŸ”„</span>
          åˆ·æ–°ä½™é¢
        </button>
        <div class="auto-refresh">
          <label>
            <input type="checkbox" id="auto-refresh-checkbox">
            è‡ªåŠ¨åˆ·æ–° (30ç§’)
          </label>
        </div>
      </div>
    </div>
  </div>

  {% if error %}
  <div class="error-message">
    <h3>é”™è¯¯ä¿¡æ¯</h3>
    <p>{{ error }}</p>
  </div>
  {% endif %}

  <div class="accounts-table-container">
    <table class="accounts-table">
      <thead>
        <tr>
          <th>äº¤æ˜“æ‰€</th>
          <th>è´¦æˆ·åç§°</th>
          <th>è´¦æˆ·ID</th>
          <th>ä½™é¢ (USDT)</th>
          <th>çŠ¶æ€</th>
          <th>é…ç½®çŠ¶æ€</th>
          <th>æ“ä½œ</th>
        </tr>
      </thead>
      <tbody id="accounts-tbody">
        {% for acc in accounts %}
        <tr class="account-row" data-exchange="{{ acc.exchange }}" data-account-id="{{ acc.account_id }}">
          <td class="exchange-cell">
            <span class="exchange-badge exchange-{{ acc.exchange }}">{{ acc.exchange|upper }}</span>
          </td>
          <td class="account-name">{{ acc.account_name }}</td>
          <td class="account-id">{{ acc.account_id }}</td>
          <td class="balance-cell">
            <span class="balance-value" data-balance="{{ acc.balance }}">
              {{ acc.balance|floatformat:2 }}
            </span>
          </td>
          <td class="status-cell">
            <span class="status-badge status-{{ acc.status|lower }}">
              {{ acc.status }}
            </span>
          </td>
          <td class="config-cell">
            {% if acc.credentials_configured %}
              <span class="config-badge config-ok">âœ“ å·²é…ç½®</span>
            {% else %}
              <span class="config-badge config-error">âœ— æœªé…ç½®</span>
            {% endif %}
          </td>
          <td class="actions-cell">
            <div class="action-buttons">
              <a href="/accounts/{{ acc.exchange }}/{{ acc.account_id }}/" 
                 class="btn btn-small btn-primary">
                æŸ¥çœ‹è¯¦æƒ…
              </a>
              <button class="btn btn-small refresh-single" 
                      data-exchange="{{ acc.exchange }}" 
                      data-account-id="{{ acc.account_id }}">
                åˆ·æ–°
              </button>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="accounts-summary">
    <div class="summary-item">
      <span class="summary-label">æ€»è´¦æˆ·æ•°:</span>
      <span class="summary-value" id="total-accounts">{{ accounts|length }}</span>
    </div>
    <div class="summary-item">
      <span class="summary-label">æ€»ä½™é¢:</span>
      <span class="summary-value" id="total-balance">è®¡ç®—ä¸­...</span>
    </div>
    <div class="summary-item">
      <span class="summary-label">æ­£å¸¸è´¦æˆ·:</span>
      <span class="summary-value" id="healthy-accounts">è®¡ç®—ä¸­...</span>
    </div>
  </div>
</div>

<script src="{% static 'js/accounts.js' %}"></script>
{% endblock %}
